<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Music Library PWA</title>
    
    <!-- PWA Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00fff7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Music Library">
    <meta name="msapplication-TileColor" content="#00fff7">
    
    <style>
        .pwa-badge {
            display: inline-block;
            background: linear-gradient(145deg, #00fff7, #00aaa5);
            color: black;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .pwa-install-section {
            text-align: center;
            margin: 40px auto;
            padding: 30px;
            background: rgba(0, 255, 247, 0.1);
            border-radius: 15px;
            border: 2px solid #00fff7;
            max-width: 800px;
        }
        
        .install-btn-main {
            background: linear-gradient(145deg, #00ff88, #00aa55);
            color: black;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 255, 247, 0.5);
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }
        
        .install-btn-main:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(0, 255, 247, 0.8);
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 5px 20px rgba(0, 255, 247, 0.5); }
            50% { box-shadow: 0 5px 30px rgba(0, 255, 247, 0.9); }
        }
        
        .floating-install {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: linear-gradient(145deg, #00fff7, #0088ff);
            color: black;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            z-index: 9999;
            box-shadow: 0 5px 20px rgba(0, 255, 247, 0.6);
            animation: pulse 2s infinite;
            display: none;
        }
        
        .install-instructions {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            text-align: left;
        }
        
        .instruction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .instruction-item {
            background: rgba(0, 255, 247, 0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #00fff7;
        }
        
        .instruction-item strong {
            color: #00fff7;
            display: block;
            margin-bottom: 8px;
        }
        
        .instruction-item ul {
            margin: 0;
            padding-left: 20px;
            font-size: 13px;
            color: #aaa;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .status-success {
            background: rgba(68, 255, 68, 0.1);
            color: #44ff44;
            border: 1px solid #44ff44;
        }
        
        .status-info {
            background: rgba(0, 255, 247, 0.1);
            color: #00fff7;
            border: 1px solid #00fff7;
        }
        
        .status-warning {
            background: rgba(255, 170, 0, 0.1);
            color: #ffaa00;
            border: 1px solid #ffaa00;
        }
    </style>
</head>
<body>

<header class="app-header">
    <h1>Music Library <span class="pwa-badge">PWA</span></h1>
    <p>Your personal music collection that works everywhere</p>
</header>

<section class="instructions-section" style="max-width: 900px; margin: 0 auto; padding: 20px;">
    
    <!-- PWA INSTALLATION SECTION - PROMINENT PLACEMENT -->
    <div class="pwa-install-section">
        <h2 style="color: #00fff7; margin-bottom: 10px;">üì± Install as App</h2>
        <p style="color: #aaa; margin-bottom: 20px;">
            Get the full native app experience! Works offline, loads instantly, and appears on your home screen.
        </p>
        
        <button id="installButton" class="install-btn-main" style="display: none;">
            üì± Install Music Library
        </button>
        
        <div id="installStatus" class="status-message status-info">
            <p>‚è≥ Checking installation status...</p>
        </div>
        
        <div class="install-instructions">
            <h4 style="color: #00fff7; margin-bottom: 10px; text-align: center;">üì≤ Manual Installation Guide</h4>
            <div class="instruction-grid">
                <div class="instruction-item">
                    <strong>üñ•Ô∏è Chrome/Edge (Desktop)</strong>
                    <ul>
                        <li>Click install button above</li>
                        <li>Or look for ‚äï in address bar</li>
                        <li>Click "Install"</li>
                    </ul>
                </div>
                <div class="instruction-item">
                    <strong>üì± Chrome (Android)</strong>
                    <ul>
                        <li>Tap menu (‚ãÆ)</li>
                        <li>"Add to Home screen"</li>
                        <li>Tap "Add"</li>
                    </ul>
                </div>
                <div class="instruction-item">
                    <strong>üçé Safari (iPhone/iPad)</strong>
                    <ul>
                        <li>Tap Share button (‚ñ°‚Üë)</li>
                        <li>Scroll down</li>
                        <li>"Add to Home Screen"</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <h2>üéµ Welcome to Your Music Library</h2>
    
    <div class="feature-cards">
        <div class="feature-card">
            <h3>üéµ Upload Music</h3>
            <p>Add your own audio files. Stored locally using IndexedDB and works completely offline.</p>
        </div>
        
        <div class="feature-card">
            <h3>üìã Smart Playlists</h3>
            <p>Create custom playlists that sync between devices.</p>
        </div>
        
        <div class="feature-card">
            <h3>‚≠ê Top 50 Database</h3>
            <p>Access Billboard's Top 50 songs with Wikipedia integration.</p>
        </div>
        
        <div class="feature-card">
            <h3>üåê Works Offline</h3>
            <p>Once installed, works without internet connection.</p>
        </div>
    </div>
    
    <div style="text-align: center; margin: 40px 0;">
        <h3>Ready to Start?</h3>
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
            <button onclick="window.location.href='upload.html'" class="cyber-button" style="padding: 12px 25px;">
                üéµ Upload Your Music
            </button>
            <button onclick="window.location.href='top-songs.html'" class="cyber-button" 
                    style="background: linear-gradient(145deg, #ffd700, #ffaa00); color: black; padding: 12px 25px;">
                ‚≠ê Explore Top 50 Songs
            </button>
            <button onclick="window.location.href='playlist.html'" class="cyber-button" style="padding: 12px 25px;">
                üìã Create Playlists
            </button>
        </div>
    </div>
</section>

<div class="bottom-nav">
    <a href="index.html"><button class="active">üè† Home</button></a>
    <a href="upload.html"><button>üì§ Upload</button></a>  
    <a href="playlist.html"><button>üìã Playlists</button></a>
    <a href="top-songs.html"><button>‚≠ê Top 50</button></a>
</div>

<!-- Floating Install Button -->
<button id="floatingInstall" class="floating-install">
    üì± INSTALL APP
</button>

<script>
console.log('üéµ Music Library PWA Loading...');

let deferredPrompt = null;
let isInstalled = false;

// DOM Elements
const installButton = document.getElementById('installButton');
const floatingInstall = document.getElementById('floatingInstall');
const installStatus = document.getElementById('installStatus');

// Check if already installed
function checkIfInstalled() {
    // Check standalone mode (desktop PWA)
    if (window.matchMedia('(display-mode: standalone)').matches) {
        isInstalled = true;
        return true;
    }
    
    // Check iOS standalone
    if (window.navigator.standalone === true) {
        isInstalled = true;
        return true;
    }
    
    return false;
}

// Update UI based on installation state
function updateInstallUI() {
    if (isInstalled) {
        // Already installed
        installButton.style.display = 'none';
        floatingInstall.style.display = 'none';
        installStatus.className = 'status-message status-success';
        installStatus.innerHTML = '<p>‚úÖ App is already installed! Open it from your home screen or app menu.</p>';
    } else if (deferredPrompt) {
        // Can be installed
        installButton.style.display = 'inline-block';
        floatingInstall.style.display = 'block';
        installStatus.className = 'status-message status-success';
        installStatus.innerHTML = '<p>‚úÖ Ready to install! Click the button above to add to your device.</p>';
    } else {
        // Manual install required
        installButton.style.display = 'none';
        floatingInstall.style.display = 'none';
        installStatus.className = 'status-message status-info';
        installStatus.innerHTML = '<p>‚ÑπÔ∏è Use the manual installation guide below based on your device.</p>';
    }
}

// Capture beforeinstallprompt event
window.addEventListener('beforeinstallprompt', (e) => {
    console.log('üéØ beforeinstallprompt event captured');
    e.preventDefault();
    deferredPrompt = e;
    updateInstallUI();
});

// Install function
async function installPWA() {
    console.log('üì± Install button clicked');
    
    if (isInstalled) {
        alert('‚úÖ App is already installed!');
        return;
    }
    
    if (!deferredPrompt) {
        alert('‚ÑπÔ∏è Installation prompt not available. Please use the manual installation guide below based on your browser/device.');
        return;
    }
    
    // Show the install prompt
    deferredPrompt.prompt();
    
    // Wait for user response
    const { outcome } = await deferredPrompt.userChoice;
    
    console.log(`User choice: ${outcome}`);
    
    if (outcome === 'accepted') {
        console.log('‚úÖ User accepted installation');
        isInstalled = true;
        updateInstallUI();
        
        // Show success message
        setTimeout(() => {
            installStatus.className = 'status-message status-success';
            installStatus.innerHTML = '<p>üéâ Installation successful! The app is being added to your device...</p>';
        }, 500);
    } else {
        console.log('‚ùå User dismissed installation');
        installStatus.className = 'status-message status-warning';
        installStatus.innerHTML = '<p>‚ÑπÔ∏è Installation cancelled. You can install later using the manual guide below.</p>';
    }
    
    deferredPrompt = null;
}

// Attach click handlers
if (installButton) {
    installButton.addEventListener('click', installPWA);
}

if (floatingInstall) {
    floatingInstall.addEventListener('click', installPWA);
}

// Listen for successful installation
window.addEventListener('appinstalled', () => {
    console.log('‚úÖ PWA installed successfully');
    isInstalled = true;
    updateInstallUI();
});

// Initialize on load
window.addEventListener('load', () => {
    console.log('üöÄ Initializing PWA...');
    
    // Check if already installed
    if (checkIfInstalled()) {
        console.log('‚úÖ App is already installed');
    }
    
    // Update UI
    updateInstallUI();
    
    // Register service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => {
                console.log('‚úÖ Service Worker registered:', reg.scope);
            })
            .catch(err => {
                console.error('‚ùå Service Worker registration failed:', err);
                installStatus.className = 'status-message status-warning';
                installStatus.innerHTML = '<p>‚ö†Ô∏è Service Worker failed to load. PWA features may be limited.</p>';
            });
    }
    
    // Debug info
    console.log('=== PWA STATUS ===');
    console.log('Installed:', isInstalled);
    console.log('Prompt available:', !!deferredPrompt);
    console.log('Service Worker support:', 'serviceWorker' in navigator);
    console.log('Manifest:', document.querySelector('link[rel="manifest"]')?.href);
});

// Online/offline status
window.addEventListener('online', () => {
    console.log('üåê Online');
});

window.addEventListener('offline', () => {
    console.log('üì¥ Offline - app will continue to work');
});
</script>

</body>
</html>